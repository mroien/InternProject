/**
 * @license
 * Copyright (c) 2014, Amazon.com
 * DACX SafeFrame v1.15 -- 2015-04-02T15:03:23
*/
!function(window,document){function receiveMessage(a){var b,c;try{if(b=JSON.parse(a.data),c=AD_MAP[b.arid],!c||stripProtocol(a.origin)!==stripProtocol(SF_DOMAIN)||"object"!=typeof b.data)throw"Invalid Message: "+JSON.stringify(a.data)}catch(d){var e="Received Error: "+a.data;return"undefined"!=typeof b&&(e+=appendErrorDetails(b.arid)),void logError(e,d,ERROR_TYPE.WARN)}c.options.debug&&console&&console.log(a);try{var f=SupportedCommands[b.command];f&&f(c,b.data)}catch(d){var e="Problem with message: "+a.data;"undefined"!=typeof b&&(e+=appendErrorDetails(b.arid)),logError(e,d,ERROR_TYPE.WARN)}}function addWindowListener(a,b){window.addEventListener?window.addEventListener(a,b,!1):window.attachEvent&&window.attachEvent("on"+a,b)}function appendJsScript(a,b,c){var d=document.createElement("script");d.charset=c||"utf-8",d.src=a,b.appendChild(d)}function scriptValidator(a,b){var c=/^((?:https?:)?\/\/)?([\w\-\.]+(?::[0-9]+)?)\/?(.*)$/,d=a.match(c)[2];return d==b}function sizeValidator(a,b){return a.height==b.height&&a.width==b.width}function checkAgainstWhitelist(a,b,c){if(!b||"object"!=typeof b)return!1;for(var d=0,e=b.length;e>d;d++)if(c(a,b[d]))return!0;return!1}function openFeedback(a,b){window.DAF=[a,b],window.DA.s(window.DA.f+"-external")}function sendCsmMetric(a,b){var c=csmFunctionHash[a];"function"==typeof window[c]&&window[c](a,b,{wb:1})}function stripProtocol(a){return a.replace(/^.{1,5}:\/\/|^\/\//,"")}function hasClass(a,b){var c=new RegExp("(^|\\s)"+b+"(\\s|$)"),d=a.className;return d&&c.test(d)}function customMessage(a,b){if(MSG_LISTENERS[a])try{MSG_LISTENERS[a](b)}catch(c){logError("Custom Message Error",c)}else logError("Unrecognized custom message key: "+a,null,ERROR_TYPE.ERROR)}function createSafeFrame(a){try{var b,c=JSON.stringify(a),d=document.getElementById(a.slot);/MSIE (6|7|8)/.test(navigator.userAgent)?b=document.createElement("<iframe name='"+c+"'>"):(b=document.createElement("iframe"),b.name=c),b.src=SF_HTML,b.scrolling="no",b.height=a.size.height||"250px",b.width=a.size.width||"300px",b.className=a.iframeClass||"",b.setAttribute("frameborder","0"),b.setAttribute("marginheight","0"),b.setAttribute("marginwidth","0"),b.setAttribute("scrolling","no"),b.setAttribute("allowtransparency","true"),b.setAttribute(ARID_ATTR,a.arid),b.style.cssText=a.iframeExtraStyle||"",b.a=a.aanParams||{},b.f=a.feedbackJsUrl||1,b.c=a.campaignId,b.isSafeframeGoldbox="goldbox-ads"==a.slotName,d.appendChild(b),AD_MAP[a.arid]={slot:d,iframe:b,options:a}}catch(e){logError("Error creating safeFrame",e)}}function delayLoad(a,b){if("windowOnLoad"===a)"complete"===document.readyState?b():addWindowListener("load",b);else if("spATFEvent"===a)hasP?P.when("search-page-utilities").execute(function(a){a.afterEvent("spATFEvent",b)}):hasAmznJQ?amznJQ.available("search-js-general",function(){SPUtils.afterEvent("spATFEvent",b)}):b();else if("criticalFeature"===a)hasP?P.when("cf").execute(b):hasAmznJQ?amznJQ.onCompletion("amznJQ.criticalFeature",b):b();else if("r2OnLoad"===a)hasP?P.when("r2Loaded").execute(b):hasAmznJQ?amznJQ.onReady("r2Loaded",b):b();else if(a.match("[^:]+:.+")){var c=a.split(":");if(c.length>1){var d=c[0],e=c[1],f=c.length>2?c[2]:e;hasP?P.when(f,"A").execute(b):hasAmznJQ?amznJQ[d](e,b):b()}else b()}else b()}function appendErrorDetails(a){var b="";if("undefined"!=typeof AD_MAP[a]){var c=AD_MAP[a].options;"undefined"!=typeof c.aanResponse&&(b=" Ad Details: "+JSON.stringify(c.aanResponse))}return b}function logError(a,b,c){b=b||new Error(a),c!=ERROR_TYPE.WARN&&(window.ueLogError?window.ueLogError(b,{logLevel:c||ERROR_TYPE.ERROR,attribution:"DACX-safeframe",message:a+" "}):console&&console.error&&console.error(a,b))}function loadAdSequence(a){return function(){var b=a.slot;if(b){var c=document.getElementById(b);c&&!c.innerHTML&&(createSafeFrame(a),loadAdFeedback(a))}}}function appendFeedbackLink(a){try{"function"!=typeof d16g_addFeedbackLink||a.isFeedbackLoaded||(a.isFeedbackLoaded=!0,d16g_addFeedbackLink(a))}catch(b){}}function modifyExistingIframes(){for(var a in AD_MAP){var b=AD_MAP[a].iframe;appendFeedbackLink(b)}}function loadAdFeedback(a){try{if(window.DA){if("undefined"==typeof AD_MAP[a.arid])throw"No ad slot found for ARID "+JSON.stringify(a.arid);var b=AD_MAP[a.arid].iframe,c="function"!=typeof d16g_addFeedbackLink?1e3:0;setTimeout(function(){appendFeedbackLink(b)},c)}else if(a.daJsUrl){window.DA=window.DA||[];var d=document.createElement("script");d.src=a.daJsUrl,d.onload=d.onreadystatechange=function(){d.readyState&&"loaded"!=d.readyState&&"complete"!=d.readyState||(d.onload=d.onreadystatechange=null,modifyExistingIframes())},document.getElementsByTagName("head")[0].appendChild(d)}}catch(e){logError("Problem loading ad feedback ",e)}}if(window.DAsf)return void window.DAsf.loadAds();window.DAsf={version:"1.15"};var SF_TYPE="text/x-dacx-safeframe",SF_HTML="//dew9ckzjyt2gn.cloudfront.net/sf/sf-1.15.html",SF_DOMAIN="//dew9ckzjyt2gn.cloudfront.net",ARID_ATTR="data-arid",hasP="undefined"!=typeof P,hasAmznJQ="undefined"!=typeof amznJQ,ERROR_TYPE={ERROR:"ERROR",WARN:"WARN",FATAL:"FATAL"},AD_MAP={},MSG_LISTENERS={},SupportedCommands={changeSize:function(a,b){var c=a.options.allowedSizes;if(checkAgainstWhitelist(b,c,sizeValidator))a.iframe.height=b.height,a.iframe.width=b.width;else{var d="Size is not whitelisted: "+b.width+" x "+b.height+appendErrorDetails(a.options.arid);logError(d)}},collapseSlot:function(a){a.slot=document.getElementById(a.options.slot),"undefined"!=typeof a.slot&&(a.slot.style.display="none")},embedScript:function(a,b){var c=a.options.allowedDomains;if(checkAgainstWhitelist(b.src,c,scriptValidator))a.slot=document.getElementById(a.options.slot),"undefined"!=typeof a.slot&&appendJsScript(b.src,a.slot,b.charset);else{var d="Domain is not whitelisted: "+b.src+appendErrorDetails(a.options.arid);logError(d)}},adFeedback:function(a){openFeedback(a.options.campaignId,a.options.aanParams)},logError:function(a,b){logError(b.message+appendErrorDetails(a.options.arid),b.error,b.level)},sendMetrics:function(a,b){sendCsmMetric(b.metric,a.options.slot)},customMessage:function(a,b){customMessage(b.key,b.body)},adDetails:function(a,b){a.options.aanResponse=b.aanResponse}},csmFunctionHash={wb:"ues",bb:"uet",af:"uet",ld:"uex"};addWindowListener("message",receiveMessage),window.DAsf.registerCustomMessageListener=function(a,b,c){var d=!1;try{if(!MSG_LISTENERS[a]||"function"!=typeof MSG_LISTENERS[a]||c)MSG_LISTENERS[a]=b,d=!0;else{var e=new Error("Custom message listener already exists for key: "+a);logError("Duplicate Key",e,ERROR_TYPE.WARN)}}catch(f){logError("Error registering custom message listener",f)}return d},window.DAsf.isSafeframeAd=function(a){var b=!1;return"string"==typeof a&&(b="undefined"!=typeof AD_MAP[a]),b},window.DAsf.getAdDetails=function(a){if(!window.DAsf.isSafeframeAd(a))return!1;var b=AD_MAP[a].options.aanResponse||{},c={creativeId:b.creativeId||"",adId:b.adId||"",adNetwork:AD_MAP[a].options.adServer||"",hostName:AD_MAP[a].options.hostDomain||"",iframe:AD_MAP[a].iframe};return c},window.DAsf.openAdFeedback=function(a){try{var b=AD_MAP[a];openFeedback(b.options.campaignId,b.options.aanParams)}catch(c){logError("Error opening feedback",c)}},window.DAsf.loadAds=function(){var indx=0,tag=null,tags=[];if("function"!=typeof document.getElementsByClassName){var divs=document.getElementsByTagName("div"),scripts=document.getElementsByTagName("script"),i=0;for(i=0;i<divs.length;i++)tags[i]=divs[i];for(i=0;i<scripts.length;i++)tags[i+divs.length]=scripts[i]}else tags=document.getElementsByClassName(SF_TYPE);for(0===tags.length&&(tags=document.getElementsByTagName("script"));tag=tags[indx++];)if("DIV"==tag.tagName&&hasClass(tag,SF_TYPE)||tag.getAttribute("type")==SF_TYPE&&!tag.getAttribute(ARID_ATTR)){var data=tag.getAttribute("data-ad-details")||tag.text||tag.innerHTML||tag.innerText;try{data=/^\s*\(function\(\)/.test(data)?eval(data):JSON.parse(data),data.arid=data.arid||Math.random().toString(16).slice(2),tag.setAttribute(ARID_ATTR,data.arid),data.hostDomain=location.protocol+"//"+location.host,data.allowedSizes="object"==typeof data.allowedSizes&&data.allowedSizes.length>=0?data.allowedSizes.concat(data.size):[data.size];var whitelistedDomains="d3l3lkinz3f56t.cloudfront.net".split(",");data.allowedDomains="object"==typeof data.allowedDomains&&data.allowedDomains.length>=0?data.allowedDomains.concat(whitelistedDomains):whitelistedDomains,data.productAdsUrl=window.paSearchTowerAdsURL||window.paCusRevAllURL,data.parentLocation=location.origin||location.protocol+location.hostname,sendCsmMetric("af",data.slot),delayLoad(data.loadAfter,loadAdSequence(data))}catch(err){data=null,logError("Error parsing sf tag",err)}}},"function"!=typeof window.postMessage&&logError("Post Message unsupported",null,ERROR_TYPE.WARN),window.DAsf.loadAds()}(window,document);